{"version":3,"file":"web.js","sourceRoot":"","sources":["../../src/web.ts"],"names":[],"mappings":"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","sourcesContent":["import {WebPlugin} from \"@capacitor/core\";\nimport type {CapacitorKhenshinPlugin} from \"./definitions\";\nimport {PaymentOptions} from \"./definitions\";\n\nexport class CapacitorKhenshinWeb\n    extends WebPlugin\n    implements CapacitorKhenshinPlugin {\n\n    private static KWS_SCRIPT_ID = 'kws_script_id';\n    private static KHIPU_WEB_ROOT: 'khipu-web-root';\n    private static KWS_TIMEOUT: 10_000\n\n\n    private khipu: any;\n\n    constructor() {\n        super();\n        this.addKws();\n        this.addKhipuWebRoot();\n    }\n\n    async startPaymentById(paymentOptions: PaymentOptions): Promise<any> {\n        this.addKws();\n        this.addKhipuWebRoot();\n        await this.ensureKhipuIsSet();\n        return this.startKhipu(paymentOptions.paymentId);\n    }\n\n    addKws(): void {\n        if (!document.getElementById(CapacitorKhenshinWeb.KWS_SCRIPT_ID)) {\n            let script = document.createElement('script');\n            script.id = CapacitorKhenshinWeb.KWS_SCRIPT_ID;\n            script.type = 'text/javascript';\n            script.src = 'https://js.khipu.com/v1/kws.js';\n            document.head.appendChild(script);\n        }\n    }\n\n    addKhipuWebRoot(): void {\n        if (!document.getElementById(CapacitorKhenshinWeb.KHIPU_WEB_ROOT)) {\n            let div = document.createElement('div');\n            div.id = CapacitorKhenshinWeb.KHIPU_WEB_ROOT;\n            document.body.appendChild(div);\n        }\n    }\n\n    ensureKhipuIsSet() {\n        var start = Date.now();\n        return new Promise(waitForKhipu); // set the promise object within the ensureFooIsSet object\n        function waitForKhipu(resolve: (arg0: any) => void, reject: (arg0: Error) => void) {\n            // @ts-ignore\n            if (typeof Khipu !== 'undefined') {\n                // @ts-ignore\n                resolve(Khipu);\n            } else if (CapacitorKhenshinWeb.KWS_TIMEOUT && (Date.now() - start) >= CapacitorKhenshinWeb.KWS_TIMEOUT)\n                reject(new Error(\"timeout waiting for kws to inject Khipu\"));\n            else {\n                setTimeout(() => {\n                    waitForKhipu(resolve, reject)\n                }, 50);\n            }\n        }\n    }\n\n    async startKhipu(paymentId: string): Promise<any> {\n        return new Promise((resolve) => {\n            // @ts-ignore\n            this.khipu = new Khipu();\n            const options = {\n                mountElement: document.getElementById(CapacitorKhenshinWeb.KHIPU_WEB_ROOT), //Elemento ancla\n                modal: true, //false si se quiere embebido\n                modalOptions: {\n                    maxWidth: 450,\n                    maxHeight: 750,\n                },\n                options: {\n                    style: {\n                        primaryColor: '#8347AD',\n                        fontFamily: 'Roboto',\n                    },\n                    skipExitPage: true, //true si se quiere que Khipu no pinte las pÃ¡ginas finales\n                },\n            }\n            this.khipu.init(options, (successResult: any) => {\n                resolve({result: 'OK', extra: successResult});\n            }, (warningResult: any) => {\n                resolve({result: 'OK', extra: warningResult});\n            }, (failureResult: any) => {\n                resolve({result: 'FAIL', extra: failureResult});\n            });\n            this.khipu.start(paymentId);\n        })\n    }\n}\n"]}